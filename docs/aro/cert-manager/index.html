<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.102.3"><meta name=generator content="Relearn 5.2.3+tip"><meta name=description content><title>ARO Custom domain with cert-manager and LetsEncrypt :: Managed OpenShift Black Belt - Unofficial Documentation</title><link href=https://rh-mobb.github.io/mobb_ninja/css/fontawesome-all.min.css?1668099530 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/fontawesome-all.min.css?1668099530 rel=stylesheet></noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/featherlight.min.css?1668099530 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/featherlight.min.css?1668099530 rel=stylesheet></noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/auto-complete.css?1668099530 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/auto-complete.css?1668099530 rel=stylesheet></noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/perfect-scrollbar.min.css?1668099530 rel=stylesheet><link href=https://rh-mobb.github.io/mobb_ninja/css/nucleus.css?1668099530 rel=stylesheet><link href=https://rh-mobb.github.io/mobb_ninja/css/fonts.css?1668099530 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/fonts.css?1668099530 rel=stylesheet></noscript><link href=https://rh-mobb.github.io/mobb_ninja/css/theme.css?1668099530 rel=stylesheet><link href=https://rh-mobb.github.io/mobb_ninja/css/theme-relearn-light.css?1668099530 rel=stylesheet id=variant-style><link href=https://rh-mobb.github.io/mobb_ninja/css/ie.css?1668099530 rel=stylesheet><link href=https://rh-mobb.github.io/mobb_ninja/css/variant.css?1668099530 rel=stylesheet><link href=https://rh-mobb.github.io/mobb_ninja/css/print.css?1668099530 rel=stylesheet media=print><script src=https://rh-mobb.github.io/mobb_ninja/js/variant.js?1668099530></script>
<script>var index_url="https://rh-mobb.github.io/mobb_ninja/index.json",baseUriFull,root_url="https://rh-mobb.github.io/mobb_ninja/",baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",baseUriFull="https://rh-mobb.github.io/mobb_ninja/",window.variants&&variants.init(["relearn-light"])</script><script src=https://rh-mobb.github.io/mobb_ninja/js/jquery.min.js?1668099530 defer></script></head><body class="mobile-support default" data-url=https://rh-mobb.github.io/mobb_ninja/docs/aro/cert-manager/><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next" href=https://rh-mobb.github.io/mobb_ninja/docs/aro/ibm-cloud-paks-for-data/ title="ARO IBM Cloud Paks 4 Data (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev" href=https://rh-mobb.github.io/mobb_ninja/docs/aro/disaster-recovery/ title="ARO - Considerations for Disaster Recovery (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle title='Menu (CTRL+ALT+m)'><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title='Table of Contents (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="4"><a itemprop=item href=https://rh-mobb.github.io/mobb_ninja/><span itemprop=name>Documentation from the MOBB</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3"><a itemprop=item href=https://rh-mobb.github.io/mobb_ninja/docs/><span itemprop=name>Documentation from the MOBB</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="2"><a itemprop=item href=https://rh-mobb.github.io/mobb_ninja/docs/aro/><span itemprop=name>Azure Red Hat OpenShift</span></a> ></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="1"><a itemprop=item href=https://rh-mobb.github.io/mobb_ninja/docs/aro/cert-manager/ aria-disabled=true><span itemprop=name>ARO Custom domain with cert-manager and LetsEncrypt</span></a></li></ol></div><div class="default-animation progress"><div class=wrapper><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#prepare-azure-account-for-azure-openshift>Prepare Azure Account for Azure OpenShift</a></li><li><a href=#get-red-hat-pull-secret>Get Red Hat pull secret</a></li></ul></li><li><a href=#deploy-azure-openshift>Deploy Azure OpenShift</a><ul><li><a href=#variables-and-resource-group>Variables and Resource Group</a></li><li><a href=#networking>Networking</a></li></ul></li><li><a href=#create-dns-zones--service-principal>Create DNS Zones & Service Principal</a></li><li><a href=#login-to-cluster>Login to Cluster</a></li><li><a href=#set-up-cert-manager>Set up Cert-Manager</a></li><li><a href=#configure-cert-manager-letsencrypt>Configure cert-manager LetsEncrypt</a><ul><li><a href=#configure-certificate-requestor>Configure Certificate Requestor</a></li><li><a href=#create--install-api-certificate>Create & Install API Certificate</a></li><li><a href=#create--install-apps-wildcard-certificate>Create & Install APPS Wildcard Certificate</a></li></ul></li><li><a href=#debugging>Debugging</a></li><li><a href=#validate-certificates>Validate Certificates</a></li><li><a href=#delete-cluster>Delete Cluster</a></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1>ARO Custom domain with cert-manager and LetsEncrypt</h1><p>ARO guide to deploying an ARO cluster with custom domain and automating certificate management with cert-manager and letsencrypt certificates to manage the *.apps and api endpoints.</p><p>Author: <a href=https://twitter.com/byron_miller>Byron Miller</a></p><h2 id=prerequisites>Prerequisites</h2><ul><li>az cli</li><li>oc cli</li><li>jq</li><li>gettext</li><li>OpenShift 4.10</li><li>domain name to use</li></ul><p>I&rsquo;m going to be running this setup through Fedora in WSL2. Be sure to always use the same terminal/session for all commands since we&rsquo;ll reference environment variables set or created through the steps.</p><p><strong>Fedora Linux</strong></p><blockquote><p>See <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-linux?pivots=dnf">Azure Docs</a> for alternative install options.</p></blockquote><ol><li><p>Import the Microsoft Keys</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
</span></span></code></pre></div></li><li><p>Add the Microsoft Yum Repository</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt; EOF | sudo tee /etc/yum.repos.d/azure-cli.repo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[azure-cli]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Azure CLI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://packages.microsoft.com/yumrepos/azure-cli
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://packages.microsoft.com/keys/microsoft.asc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></li><li><p>Install Azure CLI</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf install -y azure-cli
</span></span></code></pre></div></li><li><p>Install jq & gettext</p><p>I&rsquo;m going to rely on using shell variables interpolated into Kubernetes config and jq to build variables. Installing or ensuring the gettext & jq package is installed will allow us to use envsubst to simplify some of our configuration so we can use output of CLI&rsquo;s as input into Yamls to reduce the complexity of manual editing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf install gettext jq
</span></span></code></pre></div></li></ol><h3 id=prepare-azure-account-for-azure-openshift>Prepare Azure Account for Azure OpenShift</h3><ol><li><p>Log into the Azure CLI by running the following and then authorizing through your Web Browser</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az login
</span></span></code></pre></div></li><li><p>Register resource providers</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az provider register -n Microsoft.RedHatOpenShift --wait
</span></span><span style=display:flex><span>az provider register -n Microsoft.Compute --wait
</span></span><span style=display:flex><span>az provider register -n Microsoft.Storage --wait
</span></span><span style=display:flex><span>az provider register -n Microsoft.Authorization --wait
</span></span></code></pre></div></li></ol><h3 id=get-red-hat-pull-secret>Get Red Hat pull secret</h3><ol><li><p>Log into cloud.redhat.com</p></li><li><p>Browse to <a href=https://cloud.redhat.com/openshift/install/azure/aro-provisioned>https://cloud.redhat.com/openshift/install/azure/aro-provisioned</a></p></li><li><p>click the <strong>Download pull secret</strong> button and remember where you saved it, you&rsquo;ll reference it later.</p></li></ol><h2 id=deploy-azure-openshift>Deploy Azure OpenShift</h2><h3 id=variables-and-resource-group>Variables and Resource Group</h3><p>Set some environment variables to use later, and create an Azure Resource Group.</p><ol><li><p>Set the following environment variables</p><blockquote><p>Change the values to suit your environment</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>PULL_SECRET<span style=color:#f92672>=</span>./pull-secret.txt  <span style=color:#75715e># the path to pull-secret</span>
</span></span><span style=display:flex><span>LOCATION<span style=color:#f92672>=</span>southcentralus        <span style=color:#75715e># the location of your cluster</span>
</span></span><span style=display:flex><span>RESOURCEGROUP<span style=color:#f92672>=</span>aro-rg           <span style=color:#75715e># the name of the resource group where you want to create your cluster</span>
</span></span><span style=display:flex><span>CLUSTER<span style=color:#f92672>=</span>aro-cluster            <span style=color:#75715e># the name of your cluster</span>
</span></span><span style=display:flex><span>DOMAIN<span style=color:#f92672>=</span>lab.domain.com          <span style=color:#75715e># Domain or subdomain zone for cluster &amp; cluster api</span>
</span></span></code></pre></div></li><li><p>Create an Azure resource group</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az group create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--location $LOCATION
</span></span></code></pre></div></li></ol><h3 id=networking>Networking</h3><p>Create a virtual network with two empty subnets</p><ol><li><p>Create virtual network</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network vnet create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --name aro-vnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --address-prefixes 10.0.0.0/22
</span></span></code></pre></div></li><li><p>Create control plane subnet</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network vnet subnet create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--vnet-name aro-vnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name master-subnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--address-prefixes 10.0.0.0/23 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--service-endpoints Microsoft.ContainerRegistry
</span></span></code></pre></div></li><li><p>Create machine subnet</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network vnet subnet create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--vnet-name aro-vnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name worker-subnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--address-prefixes 10.0.2.0/23 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--service-endpoints Microsoft.ContainerRegistry
</span></span></code></pre></div></li><li><p>Disable network policies on the control plane subnet</p><blockquote><p>This is required for the service to be able to connect to and manage the cluster.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network vnet subnet update <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name master-subnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--vnet-name aro-vnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--disable-private-link-service-network-policies true
</span></span></code></pre></div></li><li><p>Create the cluster</p><blockquote><p>This will take between 30 and 45 minutes.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az aro create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name $CLUSTER <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--vnet aro-vnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--master-subnet master-subnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--worker-subnet worker-subnet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--pull-secret @$PULL_SECRET <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--domain $DOMAIN
</span></span></code></pre></div></li><li><p>Wait until the ARO cluster is fully provisioned.</p></li><li><p>Get OpenShift console URL</p><blockquote><p>You can use these to login to the web console (will get a cert warning that you can bypass with typing &ldquo;thisisunsafe&rdquo; in a chrome browser or login with oc)</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az aro show -g $RESOURCEGROUP -n $CLUSTER --query <span style=color:#e6db74>&#34;consoleProfile.url&#34;</span> -o tsv
</span></span></code></pre></div></li><li><p>Get OpenShift credentials</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az aro list-credentials --name $CLUSTER --resource-group $RESOURCEGROUP
</span></span></code></pre></div></li></ol><h2 id=create-dns-zones--service-principal>Create DNS Zones & Service Principal</h2><p>In order for cert-manager to work with AzureDNS, we need to create the zone and add a CAA record as well as create a Service Principal that we can use to manage records in this zone so CertManager can use DNS01 authentication for validating requests.</p><p>This zone should be a public zone since letsencrypt will need to be able to read records created here.</p><blockquote><p>If you use a subdomain, please be sure to <a href=https://docs.microsoft.com/en-us/azure/dns/delegate-subdomain>create the NS records</a> in your primary domain to the subdomain.</p></blockquote><p>For ease of management, we&rsquo;re using the same resource group for domain as we have the cluster in.</p><ol><li><p>Create Zone</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network dns zone create -g $RESOURCEGROUP -n $DOMAIN
</span></span></code></pre></div><blockquote><p>You will need to configure your nameservers to point to azure. The output of running this zone create will show you the nameservers for this record that you will need to set up within your domain registrar.</p></blockquote></li><li><p>Create API DNS record</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>APIREC<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az aro show -g $RESOURCEGROUP -n $CLUSTER --query apiserverProfile.ip -o tsv<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>az network dns record-set a add-record -g $RESOURCEGROUP -z $DOMAIN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-n api -a $APIREC
</span></span></code></pre></div></li><li><p>Create Wildcard DNS record</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>WILDCARDREC<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az aro show -n $CLUSTER -g $RESOURCEGROUP --query <span style=color:#e6db74>&#39;{ingress:ingressProfiles[0].ip}&#39;</span> -o tsv<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>az network dns record-set a add-record -g $RESOURCEGROUP -z $DOMAIN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-n <span style=color:#e6db74>&#34;*.apps&#34;</span> -a $WILDCARDREC
</span></span></code></pre></div></li><li><p>Add CAA Record</p><blockquote><p><a href=https://letsencrypt.org/docs/caa/>CAA is a type of DNS record</a> that allows owners to specify which Certificate Authorities are allowed to issue certificates containing their domain names.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az network dns record-set caa add-record -g $RESOURCEGROUP -z $DOMAIN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-n @ --flags <span style=color:#ae81ff>0</span> --tag <span style=color:#e6db74>&#34;issuewild&#34;</span> --value <span style=color:#e6db74>&#34;letsencrypt.org&#34;</span>
</span></span></code></pre></div><p>You should be able to view the records in your console</p><p><img src=dns-zone-records.png alt="dns records in zone"></p><blockquote><p>Note - You may have to create NS records in your root zone for a subdomain if you use a subdomain zone to point to the subdomains name servers.</p></blockquote></li><li><p>Set environment variables to build new service principal and credentials to allow cert-manager to create records in this zone.</p><blockquote><p>AZURE_CERT_MANAGER_NEW_SP_NAME = the name of the service principal to create that will manage the DNS zone automation for cert-manager.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>AZURE_CERT_MANAGER_NEW_SP_NAME<span style=color:#f92672>=</span>aro-dns-sp
</span></span><span style=display:flex><span>LETSENCRYPTEMAIL<span style=color:#f92672>=</span>youremail@work.com
</span></span><span style=display:flex><span>DNS_SP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad sp create-for-rbac --name $AZURE_CERT_MANAGER_NEW_SP_NAME --output json<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_CERT_MANAGER_SP_APP_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $DNS_SP | jq -r <span style=color:#e6db74>&#39;.appId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_CERT_MANAGER_SP_PASSWORD<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $DNS_SP | jq -r <span style=color:#e6db74>&#39;.password&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $DNS_SP | jq -r <span style=color:#e6db74>&#39;.tenant&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az account show --output json | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div></li><li><p>Restrict service principal - remove contributor role.</p><blockquote><p>Note: This may not exist, safe to proceed. We&rsquo;re going to grant the DNS Management Role to it next.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az role assignment delete --assignee $AZURE_CERT_MANAGER_SP_APP_ID --role Contributor
</span></span></code></pre></div></li><li><p>Grant DNS Zone Contributor to our Service Principal</p><p>We&rsquo;ll grant <a href=https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#dns-zone-contributor>DNS Zone Contributor</a> to our DNS Service principal.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az role assignment create --assignee $AZURE_CERT_MANAGER_SP_APP_ID --role befefa01-2a29-4197-83a8-272ff33ce314
</span></span></code></pre></div></li><li><p>Assign service principal to DNS zone</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>DNS_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az network dns zone show --name $DOMAIN --resource-group $RESOURCEGROUP --query <span style=color:#e6db74>&#34;id&#34;</span> --output tsv<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>az role assignment create --assignee $AZURE_CERT_MANAGER_SP_APP_ID --role <span style=color:#e6db74>&#34;DNS Zone Contributor&#34;</span> --scope $DNS_ID
</span></span></code></pre></div></li></ol><h2 id=login-to-cluster>Login to Cluster</h2><ol><li><p>Login to your cluster through oc cli</p><blockquote><p>You may need to flush your local dns resolver/cache before you can see the DNS/Hostnames. On Windows you can open up a command prompt as administrator and type &ldquo;ipconfig /flushdns&rdquo;</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>apiServer<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az aro show -g $RESOURCEGROUP -n $CLUSTER --query apiserverProfile.url -o tsv<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>loginCred<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az aro list-credentials --name $CLUSTER --resource-group $RESOURCEGROUP --query <span style=color:#e6db74>&#34;kubeadminPassword&#34;</span> -o tsv<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>oc login $apiServer -u kubeadmin -p $loginCred
</span></span></code></pre></div><blockquote><p>You may get a warning that the certificate isn&rsquo;t trusted. We can ignore that now since we&rsquo;re in the process of adding a trusted certificate.</p></blockquote></li></ol><h2 id=set-up-cert-manager>Set up Cert-Manager</h2><p>We&rsquo;ll install cert-manager from operatorhub. If you experience any issues installing here, it probably means that you didn&rsquo;t <a href=https://docs.microsoft.com/en-us/azure/openshift/howto-add-update-pull-secret>provide a pull-secret</a> when you installed your ARO cluster.</p><ol><li><p>Create namespace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | oc apply -f -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  annotations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    openshift.io/display-name:  Red Hat Certificate Manager Operator
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    openshift.io/cluster-monitoring: &#39;true&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: openshift-cert-manager-operator
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></li><li><p>Switch openshift-cert-manager-operator project (namespace)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc project openshift-cert-manager-operator
</span></span></code></pre></div></li><li><p>Create OperatorGroup</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | oc apply -f -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: operators.coreos.com/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: OperatorGroup
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: openshift-cert-manager-operator
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec: {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></li><li><p>Create subscription for cert-manager operator</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cat &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>operators.coreos.com/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Subscription</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-cert-manager-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-cert-manager-operator</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>tech-preview</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>installPlanApproval</span>: <span style=color:#ae81ff>Automatic</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-cert-manager-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>: <span style=color:#ae81ff>redhat-operators</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sourceNamespace</span>: <span style=color:#ae81ff>openshift-marketplace</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div><blockquote><p><em>It will take a few minutes for this operator to install and complete it&rsquo;s set up. May be a good time to take a coffee break :)</em></p></blockquote></li><li><p>Wait for cert-manager operator to finish installing.</p><p>Our next steps can&rsquo;t complete until the operator has finished installing. I recommend that you login to your cluster with the URL and credentials you captured after you ran the az aro create and view the installed operators to see that everything is complete and successful.</p><p><img src=cert-manager-operator.png alt="View cert-manager Operator for Red Hat OpenShift"></p></li></ol><h2 id=configure-cert-manager-letsencrypt>Configure cert-manager LetsEncrypt</h2><p>We&rsquo;re going to set up cert-manager to use DNS verification for letsencrypt certificates. We&rsquo;ll need to generate a service principal that can update the DNS zone and create short term records needed to validate certificate requests and associate this service principal with the cluster issuer.</p><h3 id=configure-certificate-requestor>Configure Certificate Requestor</h3><ol><li><p>Switch openshift-cert-manager project (namespace)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc project openshift-cert-manager
</span></span></code></pre></div></li><li><p>Create azuredns-config secret for storing service principal credentials to manage zone.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc create secret generic azuredns-config --from-literal<span style=color:#f92672>=</span>client-secret<span style=color:#f92672>=</span>$AZURE_CERT_MANAGER_SP_PASSWORD -n openshift-cert-manager
</span></span></code></pre></div></li><li><p>Create Cluster Issuer</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>envsubst  &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterIssuer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-prod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://acme-v02.api.letsencrypt.org/directory</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>email</span>: <span style=color:#ae81ff>$LETSENCRYPTEMAIL</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># This key doesn&#39;t exist, cert-manager creates it</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privateKeySecretRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>prod-letsencrypt-issuer-account-key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>solvers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>dns01</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>azureDNS</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>clientID</span>: <span style=color:#ae81ff>$AZURE_CERT_MANAGER_SP_APP_ID</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>clientSecretSecretRef</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>azuredns-config</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>key</span>: <span style=color:#ae81ff>client-secret</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>subscriptionID</span>: <span style=color:#ae81ff>$AZURE_SUBSCRIPTION_ID</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tenantID</span>: <span style=color:#ae81ff>$AZURE_TENANT_ID</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>resourceGroupName</span>: <span style=color:#ae81ff>$RESOURCEGROUP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>hostedZoneName</span>: <span style=color:#ae81ff>$DOMAIN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>environment</span>: <span style=color:#ae81ff>AzurePublicCloud</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div></li><li><p>Describe issuer</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc describe clusterissuer letsencrypt-prod
</span></span></code></pre></div><p>You should see some output that the issuer is Registered/Ready</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>Conditions:
</span></span><span style=display:flex><span> Last Transition Time:  2022-06-17T17:29:37Z
</span></span><span style=display:flex><span> Message:               The ACME account was registered with the ACME server
</span></span><span style=display:flex><span> Observed Generation:   1
</span></span><span style=display:flex><span> Reason:                ACMEAccountRegistered
</span></span><span style=display:flex><span> Status:                True
</span></span><span style=display:flex><span> Type:                  Ready
</span></span><span style=display:flex><span>Events:                    &lt;none&gt;
</span></span></code></pre></div><p>Once the above command is complete, you should be able to login to openshift, click view operators and make sure you&rsquo;re in the &ldquo;openshift-cert-manager-operator&rdquo; project and you should see a screen like this. Again, if you have an ssl error and use a chrome browser - type &ldquo;thisisunsafe&rdquo; to get in if you get an error its an invalid cert.</p><p><img src=cluster-issuer.png alt="cluster issuer"></p></li></ol><h3 id=create--install-api-certificate>Create & Install API Certificate</h3><ol><li><p>Switch openshift-config project</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc project openshift-config
</span></span></code></pre></div></li><li><p>Configure API certificate</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>envsubst  &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Certificate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-api</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>openshift-api-certificate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>issuerRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-prod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterIssuer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dnsNames</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>api.$DOMAIN</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div></li><li><p>View certificate status</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc describe certificate openshift-api -n openshift-config
</span></span></code></pre></div></li><li><p>Create cluster api cert job</p><p>This job will install the certificate</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>envsubst  &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>secrets</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>list</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>config.openshift.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>apiservers</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>list</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>patch</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>update</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>roleRef</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subjects</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-config</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>batch/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Job</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>argocd.argoproj.io/hook</span>: <span style=color:#ae81ff>PostSync</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>argocd.argoproj.io/hook-delete-policy</span>: <span style=color:#ae81ff>HookSucceeded</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>image-registry.openshift-image-registry.svc:5000/openshift/cli:latest</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>API_HOST_NAME</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#ae81ff>api.$DOMAIN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>/bin/bash</span>
</span></span><span style=display:flex><span>            - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              #!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              if oc get secret openshift-api-certificate -n openshift-config; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                oc patch apiserver cluster --type=merge -p &#39;{&#34;spec&#34;:{&#34;servingCerts&#34;: {&#34;namedCertificates&#34;: [{&#34;names&#34;: [&#34;&#39;$API_HOST_NAME&#39;&#34;], &#34;servingCertificate&#34;: {&#34;name&#34;: &#34;openshift-api-certificate&#34;}}]}}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;Could not execute sync as secret &#39;openshift-api-certificate&#39; in namespace &#39;openshift-config&#39; does not exist, check status of CertificationRequest&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              fi</span>              
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>serviceAccount</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>patch-cluster-api-cert</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div></li></ol><h3 id=create--install-apps-wildcard-certificate>Create & Install APPS Wildcard Certificate</h3><ol><li><p>Switch openshift-ingress project (namespace)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc project openshift-ingress
</span></span></code></pre></div></li><li><p>Configure Wildcard Certificate</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>envsubst  &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Certificate</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-wildcard</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>openshift-wildcard-certificate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>issuerRef</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-prod</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterIssuer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>commonName</span>: <span style=color:#e6db74>&#34;*.apps.$DOMAIN&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dnsNames</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;*.apps.$DOMAIN&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div><p>This will generate our API and wildcard certificate requests. We&rsquo;ll now create two jobs that will install these certificates.</p></li><li><p>View certificate status</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc describe certificate openshift-wildcard -n openshift-ingress
</span></span></code></pre></div></li><li><p>Install Wildcard Certificate Job</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cat &lt;&lt;EOF | oc apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>operator.openshift.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ingresscontrollers</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>list</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>patch</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>secrets</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>list</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>roleRef</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subjects</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-ingress</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>batch/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Job</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>argocd.argoproj.io/hook</span>: <span style=color:#ae81ff>PostSync</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>argocd.argoproj.io/hook-delete-policy</span>: <span style=color:#ae81ff>HookSucceeded</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>image-registry.openshift-image-registry.svc:5000/openshift/cli:latest</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>/bin/bash</span>
</span></span><span style=display:flex><span>            - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              #!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              if oc get secret openshift-wildcard-certificate -n openshift-ingress; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                oc patch ingresscontroller default -n openshift-ingress-operator --type=merge --patch=&#39;{&#34;spec&#34;: { &#34;defaultCertificate&#34;: { &#34;name&#34;: &#34;openshift-wildcard-certificate&#34; }}}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;Could not execute sync as secret &#39;openshift-wildcard-certificate&#39; in namespace &#39;openshift-ingress&#39; does not exist, check status of CertificationRequest&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              fi</span>              
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>serviceAccount</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>patch-cluster-wildcard-cert</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div></li></ol><h2 id=debugging>Debugging</h2><p>One of the most helpful commands i&rsquo;ve seen for debugging is in regards to challenges failing. The order says pending in perpetuity and you can run this to see why.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>oc describe challenges
</span></span></code></pre></div><p>This is a very <a href=https://cert-manager.io/docs/faq/acme/>helpful guide in debugging certificates</a> as well.</p><h2 id=validate-certificates>Validate Certificates</h2><p>It will take a few minutes for the jobs to successfully complete.</p><p>Once the certificate requests are complete, you should no longer see a browser security warning and you should have a valid SSL lock in your browser and no more warnings about SSL on cli.</p><p>You may want to open an InPrivate/Private browser tab to visit the console/api so you can see the new SSL cert without having to expire your cache.</p><h2 id=delete-cluster>Delete Cluster</h2><p>Once you&rsquo;re done its a good idea to delete the cluster to ensure that you don&rsquo;t get a surprise bill.</p><ol><li><p>Delete the cluster</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az aro delete -y <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group $RESOURCEGROUP <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name $CLUSTER
</span></span></code></pre></div></li><li><p>Delete the Azure resource group</p><blockquote><p>Only do this if there&rsquo;s nothing else in the resource group.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>az group delete -y <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name $RESOURCEGROUP
</span></span></code></pre></div></li></ol><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-wrapper class=default-animation><div id=header class=default-animation><style>#logo svg,#logo svg *{color:#282828;color:var(--MENU-SECTIONS-BG-color);fill:#282828!important;fill:var(--MENU-SECTIONS-BG-color)!important;opacity:.945}a#logo{color:#282828;color:var(--MENU-SECTIONS-BG-color);font-family:work sans,helvetica,tahoma,geneva,arial,sans-serif;font-size:30px;font-weight:300;margin-top:-13px;max-width:60%;text-transform:uppercase;width:226px;white-space:nowrap}a#logo:hover{color:#282828;color:var(--MENU-SECTIONS-BG-color)}#logo svg{margin-bottom:-20px;margin-left:-23.5px;width:40.5%}@media only all and (max-width:59.938em){a#logo{font-size:25px;margin-top:-3px}#logo svg{margin-bottom:-12px;margin-left:-23px}}@media all and (-ms-high-contrast:none){a#logo{margin-top:-58px}#logo svg{margin-bottom:-62px}}</style><a id=logo href=https://rh-mobb.github.io/mobb_ninja/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64.044 64.044"><path d="M46.103 136.34c-.642-.394-1.222-2.242-1.98-2.358-.76-.117-1.353.506-1.618 1.519-.266 1.012-.446 4.188.173 5.538.213.435.482.787 1.03.845.547.057.967-.504 1.45-1.027.482-.523.437-.9 1.142-.612.705.289 1.051.4 1.586 1.229.535.828 1.085 4.043.868 5.598-.241 1.458-.531 2.8-.59 4.088.26.075.517.148.772.217 2.68.724 5.373 1.037 7.873.02.001-.028.01-.105.008-.11-.048-.165-.18-.41-.36-.698-.18-.29-.414-.645-.586-1.114a3.212 3.212.0 01-.125-1.735c.056-.21.153-.342.249-.475 1.237-1.193 2.932-1.373 4.244-1.384.557-.004 1.389.016 2.198.255s1.706.724 2.068 1.843c.187.578.114 1.17-.043 1.623-.153.438-.369.783-.545 1.091-.178.31-.329.6-.401.821-.007.02-.003.071-.005.094 2.256 1.008 4.716.91 7.189.398.55-.114 1.11-.247 1.673-.377.344-1.085.678-2.145.852-3.208.124-.752.158-2.311-.078-3.538-.118-.613-.306-1.15-.52-1.489-.221-.349-.413-.501-.747-.538-.243-.027-.51.013-.796.098-.67.223-1.33.606-1.966.76l-.008.002-.109.032c-.556.152-1.233.158-1.797-.36-.556-.51-.89-1.367-1.117-2.596-.283-1.528-.075-3.279.89-4.518l.071-.09h.07c.65-.71 1.485-.802 2.16-.599.706.213 1.333.629 1.772.84.736.354 1.185.319 1.475.171.291-.148.5-.439.668-.955.332-1.017.301-2.819.022-4.106-.148-.684-.13-1.292-.13-1.883-1.558-.463-3.067-.982-4.574-1.208-1.128-.169-2.263-.173-3.298.164-.13.046-.256.095-.38.15-.373.164-.633.342-.805.52-.077.098-.081.105-.087.21-.004.068.031.289.13.571.1.282.256.634.467 1.03.279.524.448 1.063.431 1.618a2.12 2.12.0 01-.499 1.309 1.757 1.757.0 01-.62.51h-.002c-.515.291-1.107.404-1.723.464-.86.083-1.787.026-2.598-.097-.806-.123-1.47-.28-1.948-.555-.444-.256-.79-.547-1.037-.925a2.273 2.273.0 01-.356-1.301c.029-.837.403-1.437.625-1.897.111-.23.191-.433.236-.583.045-.15.044-.25.046-.24-.005-.029-.127-.355-1.015-.741-1.138-.495-2.322-.673-3.533-.668h-.015a9.711 9.711.0 00-.521.016h-.002c-1.163.057-2.35.308-3.541.569.383 1.531.79 2.753.818 4.502-.096 1.297.158 2.114-1.03 2.935-.85.588-1.508.729-2.15.335" style="fill:#282828;fill-opacity:1;stroke:none;stroke-width:1.03763;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" transform="translate(-40.698 -95.175)"/><path d="M61.472 101.34v.002c-.3-.003-.603.01-.894.04-.544.055-1.39.165-1.778.306-1.238.364.13 2.344.41 2.913.28.569.285 2.03.14 2.134-.144.103-.375.261-.934.345-.56.084.03-.037-1.589.086-1.62.122-5.506.29-8.265.248-.022.26-.036.521-.097.808-.309 1.442-.63 3.163-.494 4.074.071.473.168.65.414.8.23.14.737.235 1.62-.004.834-.227 1.3-.442 1.887-.456.595-.016 1.555.472 1.965.717.411.245-.03-.008.002.0s.128.05.176.102c.049.053-.276-.523.104.199.379.721.72 3.256.002 4.68-.46.913-1.01 1.49-1.64 1.711-.63.22-1.229.067-1.734-.135-.881-.353-1.584-.7-2.205-.647-1.199 1.94-1.186 4.17-.6 6.602.097.397.212.814.327 1.23 2.68-.556 5.542-1.016 8.337.132 1.064.437 1.73 1.015 1.902 1.857.169.831-.193 1.508-.438 1.986-.122.238-.23.46-.307.642-.07.164-.096.28-.104.324.069.429.309.723.686.945.385.227.89.355 1.35.423.723.104 1.567.152 2.287.086.693-.064 1.032-.338 1.241-.544a2.447 2.447.0 00.303-.437.175.175.0 00.013-.035c-.004-.066-.037-.246-.195-.527-.46-.816-.87-1.595-.817-2.51.028-.476.218-.938.529-1.288.304-.343.698-.586 1.186-.79 1.442-.606 2.96-.609 4.372-.409 1.525.216 2.963.679 4.378 1.083.226-2.09.784-3.9.592-5.77-.058-.565-.287-1.333-.598-1.827-.32-.508-.59-.717-1.036-.642-.648.11-1.472.935-2.707 1.078-.791.092-1.494-.267-1.95-.86-.45-.583-.678-1.335-.78-2.101-.202-1.525.031-3.229.89-4.27.615-.747 1.45-.887 2.15-.74.687.145 1.307.492 1.857.745v-.002c.546.252 1.033.388 1.281.344a.547.547.0 00.353-.188c.113-.124.242-.35.384-.75.604-1.712.206-3.68-.303-5.654-.667.145-1.336.293-2.018.413-1.341.236-2.73.392-4.136.273-.656-.055-1.695-.085-2.58-.476-.442-.195-.903-.514-1.157-1.093-.259-.591-.205-1.313.08-2.014.223-.64 1.082-2.178.692-2.585-.391-.407-1.651-.56-2.554-.571z" style="fill:#282828;fill-opacity:1;stroke:none;stroke-width:.992837;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" transform="translate(-40.698 -95.175)"/><path d="M83.128 98.116c-.484 1.875-1.057 3.757-2.486 5.033-.638.57-1.13.666-1.483.548-.401-.134-.715-.506-1.058-.973-.338-.461-.655-.97-1.076-1.332-.192-.165-.404-.315-.683-.38-.279-.066-.599-.02-.9.102-.489.196-.89.58-1.28 1.047a6.1 6.1.0 00-.985 1.632c-.234.591-.356 1.174-.277 1.713.072.487.392.977.905 1.185.463.187.926.156 1.36.154.433.0.843.01 1.242.147.55.189.79.736.822 1.368.034.66-.145 1.412-.393 1.988l-.008.021c-.74 1.705-1.946 2.893-3.004 4.349l-.664.915.979.099c.924.092 1.788.26 2.468.675.46.281 1.806 1.205 2.794 2.222.497.513.888 1.031 1.047 1.502.078.231.095.422.05.6a.93.93.0 01-.345.474c-.301.223-.606.395-.864.532l-.354.186c-.107.058-.189.087-.345.228a.637.637.0 01.062-.045l-.064.041-.209.236-.103.343s.003.126.007.152c.003.017.003.007.004.015v.002c.016.195.061.307.133.476a4.1 4.1.0 00.32.596 5.7 5.7.0 002.8 2.258c.284.108.908.321 1.548.36.33.02.59.015.912-.13h.002c.08-.037.228-.095.382-.281.153-.186.19-.355.212-.445l.019-.075.003-.078c.023-.585-.037-1.296.072-1.899.153-.657.435-.956 1.009-.909 2.771.239 4.74 1.955 6.693 3.83l.742.714.279-1.155c.55-2.29 1.093-4.464 2.928-5.977.692-.57 1.184-.642 1.527-.509.39.151.676.536.996.995.319.458.605.926 1.07 1.212.194.119.464.232.784.209.32-.024.638-.163.988-.384 1.022-.645 1.778-1.756 2.086-2.942.136-.522.102-.991-.046-1.301-.158-.334-.433-.553-.754-.707-.653-.314-1.468-.373-2.094-.486-.825-.15-1.22-.475-1.345-.878-.13-.417.0-.953.335-1.61.6-1.173 1.887-2.602 3.13-3.911l.498-.526-.449-.432c-1.545-1.49-3.163-3.01-5.252-3.715h-.002c-.473-.16-1.097-.413-1.73-.424h-.003c-.311-.004-.596.04-.883.24v.002c-.22.155-.483.537-.583.937l-.008.036-.006.038c-.116.773-.06 1.467-.217 1.995-.063.212-.198.418-.359.507-.202.111-.492.153-.976.072-.582-.097-1.978-.69-3.021-1.503-.523-.407-.934-.85-1.117-1.3a1.153 1.153.0 01-.083-.63c.03-.184.1-.477.308-.593.21-.116.941-.32 1.377-.642h.002c.192-.141.403-.367.518-.64.114-.275.127-.526.123-.774-.006-.142-.036-.192-.08-.3a8.417 8.417.0 00-3-3.027c-1.226-.725-2.585-1.135-3.927-1.539-.434-.12-.844-.111-1.02.466zm.912.947c1.186.364 2.357.718 3.345 1.303 1.035.612 1.864 1.488 2.507 2.528-.514.263-1.095.5-1.44.79s-.729.914-.815 1.434c-.084.509.0.968.155 1.347.301.74.85 1.276 1.44 1.735 1.18.92 2.554 1.545 3.47 1.698.604.1 1.186.088 1.739-.216.594-.327.935-.911 1.088-1.427.264-.884.193-1.664.262-2.17h.1c.3.006.926.206 1.417.371 1.646.554 3.044 1.773 4.431 3.089-1.102 1.174-2.222 2.423-2.888 3.73-.42.823-.73 1.789-.453 2.687.283.913 1.1 1.415 2.138 1.603.691.126 1.472.226 1.84.403.19.091.258.182.278.223.03.064.058.075-.023.387-.21.804-.761 1.598-1.413 2.01-.247.155-.365.183-.407.187-.042.003-.061.002-.172-.066-.144-.088-.455-.473-.772-.929-.317-.454-.714-1.07-1.452-1.356-.783-.304-1.776-.022-2.713.75-1.942 1.6-2.626 3.764-3.146 5.8-1.802-1.676-3.772-3.138-6.589-3.517h-.002c-.346-.095-1.013-.031-1.293.143-.735.501-1.005 1.132-1.168 2.007-.125.69-.082 1.216-.074 1.659-.055.006-.046.01-.104.006-.42-.026-1.035-.215-1.244-.295-.947-.361-1.774-1.006-2.314-1.857-.054-.085-.072-.132-.109-.2l.027-.016c.284-.15.656-.36 1.045-.648.44-.327.789-.798.93-1.35a2.4 2.4.0 00-.068-1.379c-.254-.751-.753-1.353-1.295-1.911-1.09-1.124-2.452-2.049-2.99-2.378-.609-.372-1.303-.44-1.981-.56.875-1.094 1.878-2.251 2.596-3.921.294-.823.543-1.907.513-2.658-.049-.97-.489-2.013-1.52-2.367-.579-.2-1.131-.204-1.58-.203-.45.002-.786-.006-.97-.08h-.002c-.264-.107-.236-.108-.268-.33-.025-.17.021-.553.183-.962a4.67 4.67.0 01.725-1.192c.29-.348.617-.59.705-.626.142-.057.176-.05.22-.04.045.011.127.052.263.17.235.201.56.671.92 1.161.354.484.791 1.08 1.543 1.33.8.267 1.784-.052 2.671-.846 1.594-1.424 2.235-3.317 2.714-5.051zm11.705 7.023c-.02.014.042-.002.042.0l-.008.035c.05-.2-.028-.04-.034-.035zM79.472 122.45a.198.198.0 01.005.023v.014c-.002-.01-.003-.03-.005-.037zm-.29.732-.006.01-.044.027c.016-.01.033-.024.05-.036z" style="color:#000;fill:#282828;stroke-width:1.02352;-inkscape-stroke:none" transform="translate(-40.698 -95.175)"/><path d="M76.694 128.845c-.85-.012-1.668.253-2.434.67-.01.592-.015 1.17.109 1.772.323 1.573.422 3.553-.07 5.147-.247.804-.684 1.535-1.347 1.891s-1.467.296-2.362-.159c-.522-.266-1.059-.62-1.487-.757-.223-.072-.392-.096-.522-.069-.13.027-.232.094-.362.27-.53.719-.681 1.823-.497 2.876.177 1.012.418 1.438.543 1.56.143.137.26.154.604.055.548-.158 1.523-.857 2.573-.972l.02-.002.5.058c.686.081 1.247.562 1.622 1.19.372.62.591 1.37.73 2.136.279 1.532.25 3.16.083 4.232-.14.91-.394 1.72-.632 2.53 1.719-.385 3.485-.692 5.307-.36 1.174.214 2.749.574 3.762 1.977l.088.122.046.159c.162.551.16 1.114.024 1.578-.13.45-.348.772-.533 1.023-.181.246-.336.444-.437.606-.102.16-.141.275-.145.336-.01.17.0.197.07.315.057.1.186.242.39.366.408.246 1.106.414 1.843.45a7.842 7.842.0 002.174-.21 4.28 4.28.0 00.822-.296c.218-.106.385-.242.377-.233l.029-.031c.025-.035.05-.072.05-.068.0-.004.0-.017-.003-.05a2.733 2.733.0 00-.21-.579c-.26-.548-.839-1.333-.822-2.46.01-.657.27-1.21.598-1.576.32-.357.696-.575 1.074-.736.759-.323 1.57-.418 2.054-.458 1.653-.136 3.252.296 4.755.765.457.142.905.29 1.352.434.325-2.258.902-4.247.598-6.217-.071-.46-.25-1.169-.486-1.684-.238-.518-.495-.762-.675-.779-.351-.032-.716.14-1.174.418-.457.277-1.005.665-1.695.742-.745.082-1.406-.291-1.84-.908-.428-.608-.653-1.394-.754-2.196-.203-1.596.016-3.377.794-4.493.568-.813 1.358-.984 2.024-.835.65.146 1.243.51 1.769.779.524.267.99.413 1.237.365a.527.527.0 00.346-.2c.11-.132.235-.373.37-.798.612-1.918.27-3.894-.246-6.054-2.815-.851-5.49-1.534-8.089-.267a.727.727.0 00-.223.148c-.024.028-.018.021-.026.056.001-.003-.01.178.07.44.162.522.611 1.29.911 1.978l.004.009.029.063.024.084V133c.162.635.016 1.297-.274 1.727-.272.404-.618.636-.952.81-.675.353-1.399.484-1.724.533a5.888 5.888.0 01-3.973-.795c-.512-.311-.876-.594-1.133-1.02-.282-.466-.318-1.084-.172-1.557.252-.814.715-1.266.971-1.89a.663.663.0 00.047-.14c.001-.013.0-.006-.007-.037a.761.761.0 00-.184-.268c-.264-.267-.865-.595-1.54-.826-1.356-.462-3.07-.659-3.583-.686-.062-.002-.121-.006-.178-.006z" style="fill:#282828;fill-opacity:1;stroke:none;stroke-width:.991342;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" transform="translate(-40.698 -95.175)"/></svg>Relearn</a></div><div class="searchbox default-animation"><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script>var contentLangs=["en"]</script><script src=https://rh-mobb.github.io/mobb_ninja/js/auto-complete.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/lunr.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/lunr.stemmer.support.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/lunr.multi.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/lunr.en.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/search.js?1668099530 defer></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=https://rh-mobb.github.io/mobb_ninja/><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class="topics collapsible-menu"><li data-nav-id=/docs/ title="Documentation from the MOBB" class="dd-item parent"><input type=checkbox id=section-2f67fdc9a362fd86f1cfd4450ed56551 class=toggle checked><label for=section-2f67fdc9a362fd86f1cfd4450ed56551></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/>Documentation from the MOBB</a><ul><li data-nav-id=/docs/quickstart-aro/ title="ARO Quickstart" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/quickstart-aro/>ARO Quickstart</a></li><li data-nav-id=/docs/quickstart-rosa/ title="ROSA Quickstart" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/quickstart-rosa/>ROSA Quickstart</a></li><li data-nav-id=/docs/aro/ title="Azure Red Hat OpenShift" class="dd-item parent"><input type=checkbox id=section-ea9c20146e4edb7d3dc5cab0ddc4bd3a class=toggle checked><label for=section-ea9c20146e4edb7d3dc5cab0ddc4bd3a></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/>Azure Red Hat OpenShift</a><ul><li data-nav-id=/docs/aro/shipping-logs-and-metrics-to-azure-blob/ title="Azure Red Hat Openshift - Shippings logs and metrics to Azure Blob storage" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/shipping-logs-and-metrics-to-azure-blob/>Azure Red Hat Openshift - Shippings logs and metrics to Azure Blob storage</a></li><li data-nav-id=/docs/aro/registry/ title="Accessing the Internal Registry from ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/registry/>Accessing the Internal Registry from ARO</a></li><li data-nav-id=/docs/aro/additional-ingress-controller/ title="Adding an additional ingress controller to an ARO cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/additional-ingress-controller/>Adding an additional ingress controller to an ARO cluster</a></li><li data-nav-id=/docs/aro/add-infra-nodes/ title="Adding infrastructure nodes to an ARO cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/add-infra-nodes/>Adding infrastructure nodes to an ARO cluster</a></li><li data-nav-id=/docs/aro/azure-policy/ title="Apply Azure Policy to Azure Policy" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/azure-policy/>Apply Azure Policy to Azure Policy</a></li><li data-nav-id=/docs/aro/disaster-recovery/ title="ARO - Considerations for Disaster Recovery" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/disaster-recovery/>ARO - Considerations for Disaster Recovery</a></li><li data-nav-id=/docs/aro/cert-manager/ title="ARO Custom domain with cert-manager and LetsEncrypt" class="dd-item active"><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/cert-manager/>ARO Custom domain with cert-manager and LetsEncrypt</a></li><li data-nav-id=/docs/aro/ibm-cloud-paks-for-data/ title="ARO IBM Cloud Paks 4 Data" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/ibm-cloud-paks-for-data/>ARO IBM Cloud Paks 4 Data</a></li><li data-nav-id=/docs/aro/gpu/ title="ARO with Nvidia GPU Workloads" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/gpu/>ARO with Nvidia GPU Workloads</a></li><li data-nav-id=/docs/aro/frontdoor/ title="Azure Front Door with ARO ( Azure Red Hat OpenShift )" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/frontdoor/>Azure Front Door with ARO ( Azure Red Hat OpenShift )</a></li><li data-nav-id=/docs/aro/azure-service-operator/ title="Azure Service Operator" class=dd-item><input type=checkbox id=section-c4973928d95ad0b6b86b8742709cea9d class=toggle><label for=section-c4973928d95ad0b6b86b8742709cea9d></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/azure-service-operator/>Azure Service Operator</a><ul><li data-nav-id=/docs/aro/azure-service-operator/v1/ title="Azure Service Operator V1 in ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/azure-service-operator/v1/>Azure Service Operator V1 in ARO</a></li><li data-nav-id=/docs/aro/azure-service-operator/v2/ title="Azure Service Operator V2 in ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/azure-service-operator/v2/>Azure Service Operator V2 in ARO</a></li></ul></li><li data-nav-id=/docs/aro/managed-upgrade-operator/ title="Enable the Managed Upgrade Operator in ARO and schedule Upgrades" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/managed-upgrade-operator/>Enable the Managed Upgrade Operator in ARO and schedule Upgrades</a></li><li data-nav-id=/docs/aro/federated-metrics/ title="Federating System and User metrics to Azure Files in Azure Red Hat OpenShift" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/federated-metrics/>Federating System and User metrics to Azure Files in Azure Red Hat OpenShift</a></li><li data-nav-id=/docs/aro/astronomer/ title="Installing Astronomer on a private ARO cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/astronomer/>Installing Astronomer on a private ARO cluster</a></li><li data-nav-id=/docs/aro/azure-arc-integration/ title="Integrating Azure ARC with ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/azure-arc-integration/>Integrating Azure ARC with ARO</a></li><li data-nav-id=/docs/aro/odf/ title="OpenShift Data Foundation with ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/odf/>OpenShift Data Foundation with ARO</a></li><li data-nav-id=/docs/aro/private-cluster/ title="Private ARO Cluster with access via JumpHost" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/private-cluster/>Private ARO Cluster with access via JumpHost</a></li><li data-nav-id=/docs/aro/setup-quay/ title="Quay on ARO" class=dd-item><input type=checkbox id=section-107cd49f6d91378e87d08e36d5f67445 class=toggle><label for=section-107cd49f6d91378e87d08e36d5f67445></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/setup-quay/>Quay on ARO</a><ul><li data-nav-id=/docs/aro/setup-quay/quay-cli/ title="Setting up Quay on an ARO cluster via CLI" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/setup-quay/quay-cli/>Setting up Quay on an ARO cluster via CLI</a></li><li data-nav-id=/docs/aro/setup-quay/quay-console/ title="Setting up Quay on an ARO cluster via Console" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/setup-quay/quay-console/>Setting up Quay on an ARO cluster via Console</a></li></ul></li><li data-nav-id=/docs/aro/ocm/ title="Registering an ARO cluster to OpenShift Cluster Manager" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/ocm/>Registering an ARO cluster to OpenShift Cluster Manager</a></li><li data-nav-id=/docs/aro/vpn/ title="Setup a VPN Connection into an ARO Cluster with OpenVPN" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/vpn/>Setup a VPN Connection into an ARO Cluster with OpenVPN</a></li><li data-nav-id=/docs/aro/trident/ title="Trident NetApp operator setup for Azure NetApp files" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/trident/>Trident NetApp operator setup for Azure NetApp files</a></li><li data-nav-id=/docs/aro/clf-to-azure/ title="Using Cluster Logging Forwarder in ARO with Azure Monitor" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/clf-to-azure/>Using Cluster Logging Forwarder in ARO with Azure Monitor</a></li><li data-nav-id=/docs/aro/egress-ipam-operator/ title="Using the Egressip Ipam Operator with a Private ARO Cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/aro/egress-ipam-operator/>Using the Egressip Ipam Operator with a Private ARO Cluster</a></li></ul></li><li data-nav-id=/docs/rosa/ title="Red Hat Openshift Service on AWS" class=dd-item><input type=checkbox id=section-d82bea3b793597b6ff01917e2ad59aae class=toggle><label for=section-d82bea3b793597b6ff01917e2ad59aae></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/>Red Hat Openshift Service on AWS</a><ul><li data-nav-id=/docs/rosa/clf-cloudwatch-vector/ title="Configuring the Cluster Log Forwarder for CloudWatch Logs using Vector" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/clf-cloudwatch-vector/>Configuring the Cluster Log Forwarder for CloudWatch Logs using Vector</a></li><li data-nav-id=/docs/rosa/dynamic-certificates/ title="Dynamic Certificates for ROSA Custom Domain" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/dynamic-certificates/>Dynamic Certificates for ROSA Custom Domain</a></li><li data-nav-id=/docs/rosa/static-ip-load-balancer/ title="Configure a load balancer service to use a static public IP" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/static-ip-load-balancer/>Configure a load balancer service to use a static public IP</a></li><li data-nav-id=/docs/rosa/verify-permissions/ title="Verify Permissions for ROSA STS Deployment" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/verify-permissions/>Verify Permissions for ROSA STS Deployment</a></li><li data-nav-id=/docs/rosa/sts-oidc-flow/ title="STS OIDC in ROSA : How it works!" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/sts-oidc-flow/>STS OIDC in ROSA : How it works!</a></li><li data-nav-id=/docs/rosa/rosa-asea-landing-zone/ title="Integrating Red Hat OpenShift Service on AWS (ROSA) and AWS Secure Environment Accelerator (ASEA) Landing Zones" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/rosa-asea-landing-zone/>Integrating Red Hat OpenShift Service on AWS (ROSA) and AWS Secure Environment Accelerator (ASEA) Landing Zones</a></li><li data-nav-id=/docs/rosa/ecr/ title="Configuring a ROSA cluster to pull images from AWS Elastic Container Registry (ECR)" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/ecr/>Configuring a ROSA cluster to pull images from AWS Elastic Container Registry (ECR)</a></li><li data-nav-id=/docs/rosa/byo-vpc/ title="Creating a Public/Private BYO VPC for ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/byo-vpc/>Creating a Public/Private BYO VPC for ROSA</a></li><li data-nav-id=/docs/rosa/kms/ title="Creating a ROSA cluster in STS mode with custom KMS key" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/kms/>Creating a ROSA cluster in STS mode with custom KMS key</a></li><li data-nav-id=/docs/rosa/custom-alertmanager/ title="Custom Alerts in ROSA 4.11.x" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/custom-alertmanager/>Custom Alerts in ROSA 4.11.x</a></li><li data-nav-id=/docs/rosa/ecr-secret-operator/ title="ECR Secret Operator" class=dd-item><input type=checkbox id=section-d622abc3689c39008edcc95bca0300b1 class=toggle><label for=section-d622abc3689c39008edcc95bca0300b1></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/ecr-secret-operator/>ECR Secret Operator</a><ul><li data-nav-id=/docs/rosa/ecr-secret-operator/iam_user/ title="Create IAM user and Policy" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/ecr-secret-operator/iam_user/>Create IAM user and Policy</a></li><li data-nav-id=/docs/rosa/ecr-secret-operator/iam_assume_role/ title="Create STS Assume Role" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/ecr-secret-operator/iam_assume_role/>Create STS Assume Role</a></li></ul></li><li data-nav-id=/docs/rosa/aws-efs-csi-operator-sts/ title="Enabling the AWS EFS CSI Driver Operator on ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/aws-efs-csi-operator-sts/>Enabling the AWS EFS CSI Driver Operator on ROSA</a></li><li data-nav-id=/docs/rosa/waf/ title="Examples of using a WAF in front of ROSA / OSD on AWS / OCP on AWS" class=dd-item><input type=checkbox id=section-6293c009b4929ddbd0c9b2918068ea94 class=toggle><label for=section-6293c009b4929ddbd0c9b2918068ea94></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/waf/>Examples of using a WAF in front of ROSA / OSD on AWS / OCP on AWS</a><ul><li data-nav-id=/docs/rosa/waf/alb/ title="This is a POC of ROSA with a AWS WAF service" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/waf/alb/>This is a POC of ROSA with a AWS WAF service</a></li><li data-nav-id=/docs/rosa/waf/readme-complex/ title="This is a POC of ROSA with a AWS WAF service" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/waf/readme-complex/>This is a POC of ROSA with a AWS WAF service</a></li><li data-nav-id=/docs/rosa/waf/cloud-front/ title="Using CloudFront + WAF" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/waf/cloud-front/>Using CloudFront + WAF</a></li></ul></li><li data-nav-id=/docs/rosa/using-sts-with-aws-services/ title="Extending ROSA STS to include authentication with AWS Services" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/using-sts-with-aws-services/>Extending ROSA STS to include authentication with AWS Services</a></li><li data-nav-id=/docs/rosa/federated-metrics-prometheus/ title="Federating Metrics to a centralized Prometheus Cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/federated-metrics-prometheus/>Federating Metrics to a centralized Prometheus Cluster</a></li><li data-nav-id=/docs/rosa/alb-sts/ title="Installing the AWS Load Balancer Controller (ALB) on ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/alb-sts/>Installing the AWS Load Balancer Controller (ALB) on ROSA</a></li><li data-nav-id=/docs/rosa/sts-and-pod-identity/ title="Integrating with AWS resources using Pod Identity" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/sts-and-pod-identity/>Integrating with AWS resources using Pod Identity</a></li><li data-nav-id=/docs/rosa/cluster-metrics-to-aws-prometheus/ title="ROSA - Federating Metrics to AWS Prometheus" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/cluster-metrics-to-aws-prometheus/>ROSA - Federating Metrics to AWS Prometheus</a></li><li data-nav-id=/docs/rosa/aws-secrets-manager-csi/ title="Using AWS Secrets Manager CSI on Red Hat OpenShift on AWS with STS" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/aws-secrets-manager-csi/>Using AWS Secrets Manager CSI on Red Hat OpenShift on AWS with STS</a></li><li data-nav-id=/docs/rosa/metrics-to-cloudwatch-agent/ title="Using the AWS Cloud Watch agent to publish metrics to CloudWatch in ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/metrics-to-cloudwatch-agent/>Using the AWS Cloud Watch agent to publish metrics to CloudWatch in ROSA</a></li><li data-nav-id=/docs/rosa/sts-cluster-logging-addon/ title="Work Around to fix the issue with the logging-addon on ROSA STS Clusters" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/sts-cluster-logging-addon/>Work Around to fix the issue with the logging-addon on ROSA STS Clusters</a></li><li data-nav-id=/docs/rosa/clf-cloudwatch-sts/ title="Configuring the Cluster Log Forwarder for CloudWatch Logs and STS" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/clf-cloudwatch-sts/>Configuring the Cluster Log Forwarder for CloudWatch Logs and STS</a></li><li data-nav-id=/docs/rosa/sts/ title="Creating a ROSA cluster in STS mode" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/sts/>Creating a ROSA cluster in STS mode</a></li><li data-nav-id=/docs/rosa/private-link/ title="Creating a ROSA cluster with Private Link enabled" class=dd-item><input type=checkbox id=section-71f53e8bae0a034c83f5c2f0c7c9c315 class=toggle><label for=section-71f53e8bae0a034c83f5c2f0c7c9c315></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/private-link/>Creating a ROSA cluster with Private Link enabled</a><ul><li data-nav-id=/docs/rosa/private-link/public-ingress/ title="Adding a Public Ingress endpoint to a ROSA Private-Link Cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/private-link/public-ingress/>Adding a Public Ingress endpoint to a ROSA Private-Link Cluster</a></li></ul></li><li data-nav-id=/docs/rosa/sts-with-private-link/ title="Creating a ROSA cluster with Private Link enabled (custom VPC) and STS" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/sts-with-private-link/>Creating a ROSA cluster with Private Link enabled (custom VPC) and STS</a></li><li data-nav-id=/docs/rosa/custom-alertmanager-4.9/ title="Custom AlertManager in ROSA 4.9.x" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/custom-alertmanager-4.9/>Custom AlertManager in ROSA 4.9.x</a></li><li data-nav-id=/docs/rosa/aws-efs-operator-on-rosa/ title="Enabling the AWS EFS Operator on ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/aws-efs-operator-on-rosa/>Enabling the AWS EFS Operator on ROSA</a></li><li data-nav-id=/docs/rosa/federated-metrics/ title="Federating System and User metrics to S3 in Red Hat OpenShift for AWS" class=dd-item><input type=checkbox id=section-9567eab834a47ae397393da72ca0280d class=toggle><label for=section-9567eab834a47ae397393da72ca0280d></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/federated-metrics/>Federating System and User metrics to S3 in Red Hat OpenShift for AWS</a><ul><li data-nav-id=/docs/rosa/federated-metrics/user-defined/ title="User Workload Monitoring on Azure Red Hat OpenShift" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/federated-metrics/user-defined/>User Workload Monitoring on Azure Red Hat OpenShift</a></li></ul></li><li data-nav-id=/docs/rosa/ack/ title="Using AWS Controllers for Kubernetes (ACK) on ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/rosa/ack/>Using AWS Controllers for Kubernetes (ACK) on ROSA</a></li></ul></li><li data-nav-id=/docs/idp/ title="Configuring IDP for ROSA and OSD" class=dd-item><input type=checkbox id=section-de867ba7872b33ba38d343e5be5e3e1c class=toggle><label for=section-de867ba7872b33ba38d343e5be5e3e1c></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/>Configuring IDP for ROSA and OSD</a><ul><li data-nav-id=/docs/idp/okta-grp-sync/ title="Using Group Sync Operator with Okta and ROSA/OSD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/okta-grp-sync/>Using Group Sync Operator with Okta and ROSA/OSD</a></li><li data-nav-id=/docs/idp/azuread-aro/ title="Configure ARO to use Azure AD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/azuread-aro/>Configure ARO to use Azure AD</a></li><li data-nav-id=/docs/idp/azuread-aro-cli/ title="Configure Azure AD as an OIDC identity provider for ARO with cli" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/azuread-aro-cli/>Configure Azure AD as an OIDC identity provider for ARO with cli</a></li><li data-nav-id=/docs/idp/azuread/ title="Configure Azure AD as an OIDC identity provider for ROSA/OSD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/azuread/>Configure Azure AD as an OIDC identity provider for ROSA/OSD</a></li><li data-nav-id=/docs/idp/gitlab-aro/ title="Configure GitLab as an identity provider for ARO" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/gitlab-aro/>Configure GitLab as an identity provider for ARO</a></li><li data-nav-id=/docs/idp/gitlab/ title="Configure GitLab as an identity provider for ROSA/OSD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/gitlab/>Configure GitLab as an identity provider for ROSA/OSD</a></li><li data-nav-id=/docs/idp/az-ad-grp-sync/ title="Using Group Sync Operator with Azure Active Directory and ROSA/OSD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/az-ad-grp-sync/>Using Group Sync Operator with Azure Active Directory and ROSA/OSD</a></li><li data-nav-id=/docs/idp/group-claims/ title="MOBB Docs and Guides - group-claims" class=dd-item><input type=checkbox id=section-af199904c6a78739e6598ab72890c976 class=toggle><label for=section-af199904c6a78739e6598ab72890c976></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/group-claims/>MOBB Docs and Guides - group-claims</a><ul><li data-nav-id=/docs/idp/group-claims/rosa/ title="Configure ROSA to use Azure AD Group Claims" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/group-claims/rosa/>Configure ROSA to use Azure AD Group Claims</a></li><li data-nav-id=/docs/idp/group-claims/aro/ title="Configure ARO to use Azure AD Group Claims" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/idp/group-claims/aro/>Configure ARO to use Azure AD Group Claims</a></li></ul></li></ul></li><li data-nav-id=/docs/misc/ title=Miscellaneous class=dd-item><input type=checkbox id=section-4743293995ef089d075c101a4e477e5c class=toggle><label for=section-4743293995ef089d075c101a4e477e5c></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/>Miscellaneous</a><ul><li data-nav-id=/docs/misc/tls-cipher-customization/ title="Configure ROSA/OSD to use custom TLS ciphers on the ingress controllers" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/tls-cipher-customization/>Configure ROSA/OSD to use custom TLS ciphers on the ingress controllers</a></li><li data-nav-id=/docs/misc/jup/ title="Jupiter Notebooks" class=dd-item><input type=checkbox id=section-7af6414e26181825f2ee42d2fad956be class=toggle><label for=section-7af6414e26181825f2ee42d2fad956be></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/jup/>Jupiter Notebooks</a><ul><li data-nav-id=/docs/misc/jup/buildnotebook/ title="How to deploy Jupyter Notebook" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/jup/buildnotebook/>How to deploy Jupyter Notebook</a></li><li data-nav-id=/docs/misc/jup/opendatahub-gpu/ title="Installing the Open Data Hub Operator" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/jup/opendatahub-gpu/>Installing the Open Data Hub Operator</a></li></ul></li><li data-nav-id=/docs/misc/default-router-custom-domain/ title="Stop default router from serving custom domain routes" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/default-router-custom-domain/>Stop default router from serving custom domain routes</a></li><li data-nav-id=/docs/misc/references/ title="Common Managed OpenShift References / Tasks" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/references/>Common Managed OpenShift References / Tasks</a></li><li data-nav-id=/docs/misc/secrets-store-csi/ title="Installing the Kubernetes Secret Store CSI on OpenShift" class=dd-item><input type=checkbox id=section-83dcfc1bac9347003164dd6ca6bb9da6 class=toggle><label for=section-83dcfc1bac9347003164dd6ca6bb9da6></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/secrets-store-csi/>Installing the Kubernetes Secret Store CSI on OpenShift</a><ul><li data-nav-id=/docs/misc/secrets-store-csi/azure-key-vault/ title="Azure Key Vault CSI on Azure Red Hat OpenShift" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/secrets-store-csi/azure-key-vault/>Azure Key Vault CSI on Azure Red Hat OpenShift</a></li><li data-nav-id=/docs/misc/secrets-store-csi/hashicorp-vault/ title="Installing the HashiCorp Vault Secret CSI Driver" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/secrets-store-csi/hashicorp-vault/>Installing the HashiCorp Vault Secret CSI Driver</a></li></ul></li><li data-nav-id=/docs/misc/common-images-namespace/ title="OpenShift - Sharing Common images" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/common-images-namespace/>OpenShift - Sharing Common images</a></li><li data-nav-id=/docs/misc/cost-management/ title="Red Hat Cost Management for Cloud Services" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/cost-management/>Red Hat Cost Management for Cloud Services</a></li><li data-nav-id=/docs/misc/oadp/ title="MOBB Docs and Guides - oadp" class=dd-item><input type=checkbox id=section-325dd7bf30613094ac338d7da82aacea class=toggle><label for=section-325dd7bf30613094ac338d7da82aacea></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/oadp/>MOBB Docs and Guides - oadp</a><ul><li data-nav-id=/docs/misc/oadp/rosa-sts/ title="Deploying OpenShift Advanced Data Protection on a ROSA cluster" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/misc/oadp/rosa-sts/>Deploying OpenShift Advanced Data Protection on a ROSA cluster</a></li></ul></li></ul></li><li data-nav-id=/docs/o11y/ title=Observability class=dd-item><input type=checkbox id=section-cf64d50e30bf8c808e1a384a9dd9f94e class=toggle><label for=section-cf64d50e30bf8c808e1a384a9dd9f94e></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/o11y/>Observability</a><ul><li data-nav-id=/docs/o11y/openshift-logging/ title="OpenShift Logging" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/o11y/openshift-logging/>OpenShift Logging</a></li><li data-nav-id=/docs/o11y/az-log-analytics/ title="Shipping logs to Azure Log Analytics" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/o11y/az-log-analytics/>Shipping logs to Azure Log Analytics</a></li></ul></li><li data-nav-id=/docs/gcp/ title="OSD on Google Cloud" class=dd-item><input type=checkbox id=section-34c34dd71fe103bc20cfa9eed6fa905c class=toggle><label for=section-34c34dd71fe103bc20cfa9eed6fa905c></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/gcp/>OSD on Google Cloud</a><ul><li data-nav-id=/docs/gcp/filestore/ title="Create Filestore Storage for OSD in GCP" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/gcp/filestore/>Create Filestore Storage for OSD in GCP</a></li><li data-nav-id=/docs/gcp/osd_preexisting_vpc/ title="Creating a OSD in GCP with Existing VPCs" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/gcp/osd_preexisting_vpc/>Creating a OSD in GCP with Existing VPCs</a></li></ul></li><li data-nav-id=/docs/redhat/ title="Other Red Hat Products" class=dd-item><input type=checkbox id=section-61ee77d4a0d9667d2a6b99ce46059f1d class=toggle><label for=section-61ee77d4a0d9667d2a6b99ce46059f1d></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/>Other Red Hat Products</a><ul><li data-nav-id=/docs/redhat/gitops/ title="Demonstrate GitOps on Managed OpenShift with ArgoCD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/gitops/>Demonstrate GitOps on Managed OpenShift with ArgoCD</a></li><li data-nav-id=/docs/redhat/3scale/ title="Deploying 3scale API Management to ROSA and OSD" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/3scale/>Deploying 3scale API Management to ROSA and OSD</a></li><li data-nav-id=/docs/redhat/rhacs/ title="Deploying Red Hat Advanced Cluster Security in ARO/ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/rhacs/>Deploying Red Hat Advanced Cluster Security in ARO/ROSA</a></li><li data-nav-id=/docs/redhat/crane/ title="Migrate Kubernetes Applications with Konveyer Crane" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/crane/>Migrate Kubernetes Applications with Konveyer Crane</a></li><li data-nav-id=/docs/redhat/acm/ title="Advanced Cluster Management" class=dd-item><input type=checkbox id=section-d7942abe72cdf38022f3b7c824316905 class=toggle><label for=section-d7942abe72cdf38022f3b7c824316905></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/acm/>Advanced Cluster Management</a><ul><li data-nav-id=/docs/redhat/acm/observability/ title="Advanced Cluster Management - Observability" class=dd-item><input type=checkbox id=section-16c8cbcc1de529ce480045089e9bde5c class=toggle><label for=section-16c8cbcc1de529ce480045089e9bde5c></label><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/acm/observability/>Advanced Cluster Management - Observability</a><ul><li data-nav-id=/docs/redhat/acm/observability/rosa/ title="Advanced Cluster Management Observability on ROSA" class=dd-item><a href=https://rh-mobb.github.io/mobb_ninja/docs/redhat/acm/observability/rosa/>Advanced Cluster Management Observability on ROSA</a></li></ul></li></ul></li></ul></li></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://github.com/vjeantet/hugo-theme-docport>Github</a></li><li><a class=padding href=https://github.com/vjeantet/hugo-theme-docport/archive/master.zip>Download</a></li><li><a class=padding href=https://gohugo.io/>Hugo Documentation</a></li><li><a class=padding href=https://rh-mobb.github.io/mobb_ninja/docport-theme/credits/>Credits</a></li></ul></div><div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><a class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></a></li><li id=select-variant-container class=footerVariantSwitch><a class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=relearn-light value=relearn-light selected>Relearn Light</option></select></div><div class=select-clear></div></a><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><a class=padding onclick=clearHistory()><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=https://rh-mobb.github.io/mobb_ninja/js/clipboard.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/perfect-scrollbar.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/featherlight.min.js?1668099530 defer></script>
<script src=https://rh-mobb.github.io/mobb_ninja/js/theme.js?1668099530 defer></script></body></html>